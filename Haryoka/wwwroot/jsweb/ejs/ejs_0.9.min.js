var EjsScanner,EjsBuffer;String.prototype.rsplit=function(n){for(var t=this,i=n.exec(t),u=[],r,f,e;i!=null;)r=i.index,f=n.lastIndex,r!=0&&(e=t.substring(0,r),u.push(t.substring(0,r)),t=t.slice(r)),u.push(i[0]),t=t.slice(i[0].length),i=n.exec(t);return!t==""&&u.push(t),u};String.prototype.chop=function(){return this.substr(0,this.length-1)};EjsScanner=function(n,t,i){this.left_delimiter=t+"%";this.right_delimiter="%"+i;this.double_left=t+"%%";this.double_right="%%"+i;this.left_equal=t+"%=";this.left_comment=t+"%#";this.SplitRegexp=t=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)");this.source=n;this.stag=null;this.lines=0};EjsView=function(n){this.data=n};EjsView.prototype.partial=function(n,t){return t||(t=this.data),new EJS(n).render(t)};EjsScanner.to_text=function(n){return n==null||n===undefined?"":n instanceof Date?n.toDateString():n.toString?n.toString():""};EjsScanner.prototype={scan:function(n){var i,t,r;if(scanline=this.scanline,regex=this.SplitRegexp,!this.source=="")for(i=this.source.rsplit(/\n/),t=0;t<i.length;t++)r=i[t],this.scanline(r,regex,n)},scanline:function(n,t,i){var u,r,f;for(this.lines++,u=n.rsplit(t),r=0;r<u.length;r++)if(f=u[r],f!=null)try{i(f,this)}catch(e){throw{type:"EjsScanner",line:this.lines};}}};EjsBuffer=function(n,t){this.line=[];this.script="";this.pre_cmd=n;this.post_cmd=t;for(var i=0;i<this.pre_cmd.length;i++)this.push(n[i])};EjsBuffer.prototype={push:function(n){this.line.push(n)},cr:function(){this.script=this.script+this.line.join("; ");this.line=[];this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var n=0;n<this.post_cmd.length;n++)this.push(pre_cmd[n]);this.script=this.script+this.line.join("; ");line=null}}};EjsCompiler=function(n,t){this.pre_cmd=['___ejsO = "";'];this.post_cmd=[];this.source=" ";n!=null&&(typeof n=="string"?(n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),this.source=n):n.innerHTML&&(this.source=n.innerHTML),typeof this.source!="string"&&(this.source=""));t=t||"<";var i=">";switch(t){case"[":i="]";break;case"<":break;default:throw t+" is not a supported deliminator";}this.scanner=new EjsScanner(this.source,t,i);this.out=""};EjsCompiler.prototype={compile:function(n){var s,f,r,e;n=n||{};this.out="";var u="___ejsO += ",h=u,i=new EjsBuffer(this.pre_cmd,this.post_cmd),t="",o=function(n){return n=n.replace(/\\/g,"\\\\"),n=n.replace(/\n/g,"\\n"),n.replace(/"/g,'\\"')};this.scanner.scan(function(n,r){if(r.stag==null)switch(n){case"\n":t=t+"\n";i.push(u+'"'+o(t)+'";');i.cr();t="";break;case r.left_delimiter:case r.left_equal:case r.left_comment:r.stag=n;t.length>0&&i.push(u+'"'+o(t)+'"');t="";break;case r.double_left:t=t+r.left_delimiter;break;default:t=t+n}else switch(n){case r.right_delimiter:switch(r.stag){case r.left_delimiter:t[t.length-1]=="\n"?(t=t.chop(),i.push(t),i.cr()):i.push(t);break;case r.left_equal:i.push(h+"(EjsScanner.to_text("+t+"))")}r.stag=null;t="";break;case r.double_right:t=t+r.right_delimiter;break;default:t=t+n}});t.length>0&&i.push(u+'"'+o(t)+'"');i.close();this.out=i.script+";";s="this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ejsO;}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(s)}catch(e){if(typeof JSLINT!="undefined"){for(JSLINT(this.out),f=0;f<JSLINT.errors.length;f++)if(r=JSLINT.errors[f],r.reason!="Unnecessary semicolon."){r.line++;e=new Error;e.lineNumber=r.line;e.message=r.reason;n.url&&(e.fileName=n.url);throw e;}}else throw e;}}};EJS=function(n){var i,t;if(this.set_options(n),n.url){if(t=EJS.get(n.url,this.cache),t)return t;if(t==EJS.INVALID_PATH)return null;if(this.text=EJS.request(n.url),this.text==null)throw"There is no template at "+n.url;this.name=n.url}else if(n.element){if(typeof n.element=="string"&&(i=n.element,n.element=document.getElementById(n.element),n.element==null))throw i+"does not exist!";this.text=n.element.value?n.element.value:n.element.innerHTML;this.name=n.element.id;this.type="["}t=new EjsCompiler(this.text,this.type);t.compile(n);EJS.update(this.name,this);this.template=t};EJS.config=function(n){EJS.cache=n.cache!=null?n.cache:EJS.cache;EJS.type=n.type!=null?n.type:EJS.type;var t={};EJS.get=function(n,i){return i==!1?null:t[n]?t[n]:null};EJS.update=function(n,i){n!=null&&(t[n]=i)};EJS.INVALID_PATH=-1};EJS.config({cache:!0,type:"<"});EJS.prototype={render:function(n){var t=new EjsView(n);return this.template.process.call(t,n,t)},out:function(){return this.template.out},set_options:function(n){this.type=n.type!=null?n.type:EJS.type;this.cache=n.cache!=null?n.cache:EJS.cache;this.text=n.text!=null?n.text:null;this.name=n.name!=null?n.name:null},update:function(n,t){if(typeof n=="string"&&(n=document.getElementById(n)),t==null)return _template=this,function(t){EJS.prototype.update.call(_template,n,t)};typeof t=="string"?(params={},params.url=t,_template=this,params.onComplete=function(t){var i=eval(t.responseText);EJS.prototype.update.call(_template,n,i)},EJS.ajax_request(params)):n.innerHTML=this.render(t)}};EJS.newRequest=function(){for(var t,i=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<i.length;n++)try{if(t=i[n](),t!=null)return t}catch(r){continue}};EJS.request=function(n){var t=new EJS.newRequest;t.open("GET",n,!1);try{t.send(null)}catch(i){return null}return t.status==404||t.status==2||t.status==0&&t.responseText==""?null:t.responseText};EJS.ajax_request=function(n){n.method=n.method?n.method:"GET";var t=new EJS.newRequest;t.onreadystatechange=function(){if(t.readyState==4)if(t.status==200)n.onComplete(t);else n.onComplete(t)};t.open(n.method,n.url);t.send(null)};EjsView.prototype.date_tag=function(n,t){var i,r,u;t instanceof Date||(t=new Date);var h=["January","February","March","April","May","June","July","August","September","October","November","December"],e=[],o=[],s=[],f=t.getFullYear(),c=t.getMonth(),l=t.getDate();for(i=f-15;i<f+15;i++)e.push({value:i,text:i});for(r=0;r<12;r++)o.push({value:r,text:h[r]});for(u=0;u<31;u++)s.push({value:u+1,text:u+1});var a=this.select_tag(n+"[year]",f,e,{id:n+"[year]"}),v=this.select_tag(n+"[month]",c,o,{id:n+"[month]"}),y=this.select_tag(n+"[day]",l,s,{id:n+"[day]"});return a+v+y};EjsView.prototype.form_tag=function(n,t){return t=t||{},t.action=n,t.multipart==!0&&(t.method="post",t.enctype="multipart/form-data"),this.start_tag_for("form",t)};EjsView.prototype.form_tag_end=function(){return this.tag_end("form")};EjsView.prototype.hidden_field_tag=function(n,t,i){return this.input_field_tag(n,t,"hidden",i)};EjsView.prototype.input_field_tag=function(n,t,i,r){return r=r||{},r.id=r.id||n,r.value=t||"",r.type=i||"text",r.name=n,this.single_tag_for("input",r)};EjsView.prototype.is_current_page=function(n){return window.location.href==n||window.location.pathname==n?!0:!1};EjsView.prototype.link_to=function(n,t,i){var n,i;return n||(n="null"),i||(i={}),i.confirm&&(i.onclick=' var ret_confirm = confirm("'+i.confirm+'"); if(!ret_confirm){ return false;} ',i.confirm=null),i.href=t,this.start_tag_for("a",i)+n+this.tag_end("a")};EjsView.prototype.submit_link_to=function(n,t,i){var n,i;return n||(n="null"),i||(i={}),i.onclick=i.onclick||"",i.confirm&&(i.onclick=' var ret_confirm = confirm("'+i.confirm+'"); if(!ret_confirm){ return false;} ',i.confirm=null),i.value=n,i.type="submit",i.onclick=i.onclick+(t?this.url_for(t):"")+"return false;",this.start_tag_for("input",i)};EjsView.prototype.link_to_if=function(n,t,i,r,u,f){return this.link_to_unless(n==!1,t,i,r,u,f)};EjsView.prototype.link_to_unless=function(n,t,i,r,u){return r=r||{},n?u&&typeof u=="function"?u(t,i,r,u):t:this.link_to(t,i,r)};EjsView.prototype.link_to_unless_current=function(n,t,i,r){return i=i||{},this.link_to_unless(this.is_current_page(t),n,t,i,r)};EjsView.prototype.password_field_tag=function(n,t,i){return this.input_field_tag(n,t,"password",i)};EjsView.prototype.select_tag=function(n,t,i,r){var u,f,e,o;for(r=r||{},r.id=r.id||n,r.value=t,r.name=n,u="",u+=this.start_tag_for("select",r),f=0;f<i.length;f++)e=i[f],o={value:e.value},e.value==t&&(o.selected="selected"),u+=this.start_tag_for("option",o)+e.text+this.tag_end("option");return u+this.tag_end("select")};EjsView.prototype.single_tag_for=function(n,t){return this.tag(n,t,"/>")};EjsView.prototype.start_tag_for=function(n,t){return this.tag(n,t)};EjsView.prototype.submit_tag=function(n,t){return t=t||{},t.type=t.type||"submit",t.value=n||"Submit",this.single_tag_for("input",t)};EjsView.prototype.tag=function(n,t,i){var i,f,r,u;i||(i=">");f=" ";for(r in t)u=t[r]!=null?t[r].toString():"",r=="Class"&&(r="class"),f+=u.indexOf("'")!=-1?r+'="'+u+'" ':r+"='"+u+"' ";return"<"+n+f+i};EjsView.prototype.tag_end=function(n){return"<\/"+n+">"};EjsView.prototype.text_area_tag=function(n,t,i){return i=i||{},i.id=i.id||n,i.name=i.name||n,t=t||"",i.size&&(i.cols=i.size.split("x")[0],i.rows=i.size.split("x")[1],delete i.size),i.cols=i.cols||50,i.rows=i.rows||4,this.start_tag_for("textarea",i)+t+this.tag_end("textarea")};EjsView.prototype.text_tag=EjsView.prototype.text_area_tag;EjsView.prototype.text_field_tag=function(n,t,i){return this.input_field_tag(n,t,"text",i)};EjsView.prototype.url_for=function(n){return'window.location="'+n+'";'};EjsView.prototype.img_tag=function(n,t,i){return i=i||{},i.src=n,i.alt=t,this.single_tag_for("img",i)};